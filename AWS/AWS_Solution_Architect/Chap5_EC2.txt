EC2
    Web service provides resizable compute capacity in the Cloud
    Reduces the time to obtain and boot new server (instance) to minutes
    Scallable 
    EC2 types:
        On-demand
        Reservced
        Spot
        Dedicated Hosts
    EC2 instance types - Mnemonic:
        FIGHT DR MC PXZ AU - "Fight Doctor Mac Pixzy AU"
        F - FPGA
        I - IOPS
        G - Graphics
        H - High Disk Throughput
        T - Cheap general purpose (T2 micro)
        D - Density
        R - RAM
        M - Main choice for general purpose apps
        C - compute
        P - Graphics (Pics)
        X - Extreme memory
        Z - Extreme memory and compute
        A - Arm-based workloads
        U - Bare metal

First EC2 instance
    EBS Termination Protection is off by default, must turn on  
    EC2's root drive will be deleted when the instance is terminated
    EBS Root Volume of default AMI can be encrypted

Security Group
    All inbound traffic is blocked by default
    All outbound traffic is allowed
    Changes to Security Groups take effect immediately
    EC2 to Security Group is many-to-many:
        A Security Group can be added to multiple EC2 instances 
        An EC2 instance can have more than one Security Group
    Security Group is STATEFUL 
        If you create an inbound rule allowing traffic in, that traffic is automatically allowed back out again
        -> If you open port 80 for inbound, the outbound of port 80 will automatically open 
    Cannot block IP addresses using Security Group, instead NACL
    CAN allow rules, CANNOT deny rules

EBS 101
    - Amazone Elastic Block Store (EBS) 
    - virtual hard disk 
    - automatically replicate within its AZs
    - high availability + durability
    5 flavors:
            -Name-                          -API_name-      -max_IOPS-      -UseCase-
        ---------------------------------------------------------------------------------------------------------------
        - General Purpose (SSD):            gp2             16,000          most workloads
        - Provisioned IOPS (SSD)            io1             64,000          databse (better than GP)
        - Throughput Optimized (HDD)        st1             500             big data/warehouse (less IOPS more capacity)
        - Cold (HDD)                        sc1             250             FileServer
        - EBS Magnetic (HDD)                standard        40-200          IA workloads

EBS Volume
    - exist on EBS
    - will ALWAYS be in the same AZ as the EC2 instance
    - can be changed on the fly (size:eg. 500GB->1000GB and type:eg. gp2->io1->sc1)

EBS Snapshots
    - exist on S3 (think of snapshots as a photograph of the disk)
    - are point in time copies of Volumes
    - are incremental:
        - first snapshot takes longer to create (full snapshot)
        - next snapshot will take less longer (incremental of blocks that have changed since the last snapshot)
    - can take snapshot while instance is running but best to stop it first
    - can create AMI from snapshots

EBS Volume migration
    - to move EC2 volume from one AZ/Region to another
    How: take a snapshot -> create an AMI from the snapshot -> move the AMI to another AZ/Region -> launch the EC2 from that AMI
    - Snapshots:
        -> Snapshots of encrypted volumes are encrypted automatically (use this to encrypt an unencrypted instance)
        -> Volume restored from encrypted snapshots are encrypted automatically (use this to encrypt an unencrypted instance)
        -> encrypted snapshots are sharable 
        -> shared snapshots can be share with other accounts or made public

AMI Types (EBS and Snapshots)
    - To spin up an AMI, user must choose: 
        - Region
        - OS
        - Architecture (32-bit/64-bit)
        - Launch Permissions
        - 2 types of Storage for Root Device:
            +Instance Store (EPHEMERAL STORAGE):    root device is instance store volume created from a template stored in S3
            +EBS Backed Volumes:                    root device is EBS volume created from EBS snapshots
    - Instance Store Volume vs EBS Volumes:
        - Instance Store Volume (Instance Backed)
            -> Ephemeral Storage: volatile temporary storage  
            -> Cannot be stopped
            -> If host failed, lose data
            -> Root will be deleted on Termination
        - EBS Volume:
            -> Can be stopped
            -> Will not lose data if the instance stop/terminated
            -> Root will be deleted on Termination, can tell AWS to keep root 

ENI - Elastick Network Interface: (For basic networking, sepera dfefete management network, low cost)
    - a locagical network card
    - a component of VPC
    - a primary private IPv4
    - can add a secondary ENI -> secondary IPv4 (Multiple ENIs)
        Use case:
            + management network: seperate management network with production network
            + network and security appliances in VPC: to seperate with other network
            + create dual-homed instances with workloads/roles on distinct subnets
            + create a low-budget, HA solution

EN - Enhanced Networking (Need speed 10Gpbs - 100Gbps, reliable-high throughput)
    - provide high-performance networking capability
        + high bandwidth
        + high packet per second (PPS)
        + lower inter-instance latencies
    - use single root I/O virtualization (SR-IOV) 
    - requires supported instances
    - no extra charge
    Elastic Network Adapter vs Virtual Function
        - ENA: Elastic Network Adapter, support newer instance type, up to 100 Gbps
        - VF: Intel 82599 Virtual Function, support older instance type, up to 10 Gbps

EFA - Elastic Fabric Adapter (to accelerate HPC + ML, need OS by-pass)
    - a network device attach to EC2 instance to accelerate High Perormance Computing (HPC) and machine learning applications
    - provides consistent lower latency + high throughput (compares to traditionally TCP transport) using cloud-based HPC system
    - EFA use OS-bypass:
        OS-bypass enables HPC and machine learning application to bypass OS kernel, communicate directly with EFA device, REALLY FAST, REALLY LOW LATENCY
    - Support Linux only, no Windows

Encrypted Root Device - Root Device Volume = RDV
    Root Device - hard disk that has instance OS on
    Can you encrypte root device? - Before, no. Now, yes.
    How: Encrypt root device while creating new instance
    If the instance root device created unencrypted, you have to:
        1. Create a Snapshot on unencrypted RDV
        2. Copy that Snapshot + select encrypted 
        3. Create an AMI from encrypted Snapshot
        4. Use that AMI to launch a new encrypted instance
        *To delete the encrypted Snapshot, must delete the AMI associates with it first
    =>Snapsots of encrypted volumes are encrypted automatically
    =>Volumes restored from encrypted Snapshots are encrypted automatically
    =>Only uncrypted snapshots are sharable (with other accounts or public)
    =>Can encrypt root device volumes while creating EC2 instance

Spot Instances and Spot Fleets
    Spot Instance - set a price cap, if the price goes above the cap, instance will be
        terminated in 2 minutes
    Spot block - to block Instance from termination when price go above cap between
        1 to 6 hours
    Request type: One-time vs Persistent
        One time - when price goes above price cap -> closed Spot Instance
        Persistent - when price goes above price cap -> stop Spot Instance until price
                                                        goes below cap then relaunch 
    Spot Fleets - a collection of Spot Instances, optionally On-Demand instances
        Spot Fleets will try to match the target capacity with price restraints
            - setup launch pools (define EC2 instance type)
            - can have multiple pools, Fleet will choose the best way to implement 
                depending on the strategy
            - Fleet will stop launching instances once reach price threshold or capacity desire
        Strategy: capacityOptimized, lowestPrice, diversified, InstancePollsToUseCount
            capacityOptimized - pick the most optimized instance to lauch
            lowestPrice - choose the lowest price instance to launch
            diversified - distributed across all pools
            InstancePollsToUseCount - diversified + lowestPrice

EC2 hibernation
    - 
    How: Save the running EC2's ram on the EBS root volume. Then use it to reloaded
        back onto the RAM when the EC2 relaunch.
    Good for:
        - long-running process
        - services take time to initialize 
    Root device must be encrypted
    Instance RAM must be < 150GB
    Can't be hibernate > 60 days
    Available for On-Demand instances and Reserved Instances

CloudWatch
    -> monitoring performance of AWS resources
    -> monitor applications run on AWS
    -> with EC2 will monitor events every 5 minutes (Standard - default) and 1 minute (Detailed Monitoring - not free)
    -> Alarms = trigger notifications
    -> Dashboard = custom what to monitor 
    -> Events = respond to state changes in AWS resources
    -> Logs = logs
    -> CloudWatch(performance) vs CloudTrail(auditing)
        -> CloudWatch monitor performance (resource, applications resource use)
        -> CloudTrail monitor API calls (users activities)

CLI
    -> command line to interact with AWS from anywhere
    -> created from IAM

IAM roles - enable AWS resource access to users without sharing private keys
    Why roles:
        -> more secure than storing access key and secret access key on individual EC2 instances
        -> easier to manage
        -> can be assigned to EC2
        -> created by console & conmand line (access key and secret access key can only be created via console IAM)
        -> universal - can be used Global
    *Solution- the idea is to give one EC2 instance a roll (permission) that whoever CLI into this instance can control/call API to other resources
            (EC2, S3, etc.) without having to 'aws configure'. If this those instances with this particular roll got hack, we simply change the roll
            permission. We don't have to go inside each EC2 instance to clean out .aws folder.

Bootstrap Scripts
    - Bootstrap Script runs when EC2 first boot
    - Automating software install and updates = POWERFUL
    How:
        Upon EC2 lauching
            - Assign IAM Roll: to make sure this EC2 can make API to other resource
            - Expand Advance:
                #!/bin/bash
                yum update -y
                yum install httpd -y
                service httpd start
                chkconfig httpd on
                cd /var/www/html
                echo "<html><h1>Hello Cloud Gurus Welcome To My Webpage</h1></html>" > index.html
                aws s3 mb s3://YOURBUCKETNAMEHERE
                aws s3 cp index.html s3://YOURBUCKETNAMEHERE

Instance Metadata
    curl http://169.254.169.254/latest/meta-data/
    curl http://169.254.169.254/latest/user-data
    To write it on text: > bootstrap.txt

EFS Elastic File system
    - is a file storage service to connect more than one EC2 instance at a time (EBS can do 1 on 1)
    - elastic capacity = grow/shrink automatically 
    - pay-as-you-go
    - no pre-provisioning
    - can scale to petabytes
    - support thousands of concurrent NFS connections (vs EBS)
    - store data across multi-AZs within a Region
    - Read-after-write Consistency
    How/Lab
        - Create 2 EC2 instances 
            + with a same EC2-sg
            + install EFS utilities on 2 instances: yum install -y amazon-efs-utils
        - Create EFS 
            + with default VPC (has default VPC security group)
        - Open default VPC-sg to EC2-sg
            + under EC2 > Network&Security > Security Groups > VPC-sg > Inbound > NFS, TCP, 2049, EC2-sg
        - Mount EFS on each EC2 instance
            + sudo mount -t efs -o tls fs-xxxxxxxx:/ /var/www/html

FSx for Windows
    - Amazon FSx for Windows FS provides fully managed native Microsoft Windows FS
    - To easily move Windows-based applications that require file storage to AWS
        For example: Sql Server, Active Directory, IIS, Sharepoint
    - built in Windows Server
                ==================                                ==================
                    Windows FSx                                         EFS (Linux)
    =========================================================================================================
    => runs Windows Server Message Block (SMB)-based        => managed NAS filer for EC2 instances based on
        file services                                           Network File System (NFS) version 4
    => designed for Windows and Windows applications        => one of the first network file sharing protocols
    => support AD users, access control list, groups,           native to Unix and Linux
        and security policies with Distributed File
        System (DFS) namespaces and replications

FSx for Lustre (HPC/ML)
    - Amazon FSx for Lustre is a fully managed file system that is optimized for compute-intesive workloads
        + HPC - high performance Computing
        + ML - machine learning
        + EDA - Electronic design automation
        + Media data processing
    - a file system that can process massive data sets at gigabytes per second of throughputs, millions of IOPS, sub-ms latencies
        
EC2 Placement Groups (Clustered vs Spread vs Partitioned)
    1. Clustered Placement Group - low network latency + high throughput
        - Grouping EC2 instances in a single AZ
        - Low latency, high network through production
        - Vulnerable to hardware failure
    2. Spread Placement Group - critical instances + HA
        - Spread EC2 instances onto multiple AZ (same Region)
        - Protect from hardware failures
    3. Partitioned Placement Group - Multiple instances HDFS, HBase, Cassandra
        - Spread group of EC2 instances onto multiple AZ (same region) (combine Clustered and Spreaded together)
        - Have the benefit of both
    => Clustered can't span multiple AZs
    => Spreaded and Partitioned can
    => recommended homogenous instances with in Clustered
    => can't merge placement groups
    => can move existing instance into placement group  
        + must be at stopped STATEFUL
        + must use AWS CLI or AWS SDK, no console yet

High Performance Computing HPC
    Data Transfer:
        - Snowball, Snowmobile
        - AWS DataSync (store to S3, EFS, FSx, etc.)
        - Direct connect
    Compute:
        - EC2 instance CPU/GPU Optimized
        - EC2 Fleet (Spot/Spot Fleets)
        - Placement Groups (Clustered only)
    Networking:
        - Enchanced Networking SR-IOV
            -> using SR-IOV (single root IO virtualization), high throughput, lower CPU utilization
            -> provides higher bandwidth, packet per second PPS + low latencies
            -> no extra charge for Enchanced Networking in AWS
        - Elastic Network Adapters (ENA=100Gbps, VF=10Gbps)
            -> ENA = Elaster Network Adapter 
            -> VF = Intel 82599 Virtual Function (legacy flavor)
        - Elastic Fabric Adapters (Linux only)
            -> an attachable network device to accelerate HPC/ML
            -> OS-bypass = enables HPC/ML applications to bypass OS kernel - communicate directly with EFA device (Linux only)
            -> lower + consistent latency, high throughput vs TCP transport
    Storage:
        What are te storage services that allow us to achive HPC on AWS?
        - Instance-attached storage:
            - EBS 
                -> up to 64,000 IOPS with Provisioned IOPS
            - Instance Store 
                -> scale to millions IOPS, low ms
        - Network storage:
            -> S3 (not a file system)
            -> EFS (Elastic File System)
            -> FSx for Lustre: HPC-optimized distributed FS, millions of IOPs, backed by S3
    Orchestration:
        - AWS Batch: 
            -> support multi-node parallel jobs - run single job span all EC2 instances
            -> schedule jobs and launch EC2 instances on-demands
        - AWS ParallelCluster:
            -> is cluster management tool to deploy + manage HPC clusters
            -> open-source
            -> simple text file to model/provision HPC resources
            -> automate creation: VPC, subnet, cluster type, instance type

AWS WAF - Web Applcation Firewall
    - is a web application firewall (Layer 7)
    - monitor HTTP and HTTPS requests forwarded to CloudFront, Application Load Balancer (ALB), or API Gateway
    - to control access to my content
    How?
        - configure conditions:
            -> what IP addresses are allowed to make requests
            -> what query string parameters need to be passed for the requests
            -> etc.
        - then ALB/CloudFront/API_Gateway will either:
            -> Allow = release content
            -> Denied = HTTP 403 Status Code
    3 different behaviours"
        1. Allow all requests except specifies
        2. Block all requests except specifies
        3. Passive mode: Count the requests that match with specifies
    Protech agaisnt web attacks using conditions. Such as:
        - requestor IP addresses
        - requestor Country
        - Values in headers
        - Strings in requests: specific strings, or string match with expression (regex) patterns
        - request length
        - presence of SQL code (SQL injection), script (cross-site scripting)

Quiz
    What hypervisor EC2 hosted on?
        -> Xen
        -> Nitro-hypervisor
    